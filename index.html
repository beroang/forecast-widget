<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weekly Weather â€” Sydney, Australia</title>
  <style>
    :root{font-family:Inter,system-ui,Arial;margin:0;padding:0;color:#111}
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(180deg,#e8f0ff,#fff);}
    .container{width:100%;max-width:900px;padding:24px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    h1{font-size:1.25rem;margin:0}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
    .card{background:white;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(16,24,40,0.06);text-align:center}
    .date{font-weight:600;margin-bottom:6px}
    .temp{font-size:1.1rem;margin:6px 0}
    .desc{font-size:.9rem;color:#555}
    .icon{width:48px;height:48px;margin:6px auto}
    .loader{padding:24px;text-align:center;color:#666}
    footer{margin-top:14px;font-size:.85rem;color:#444}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Weekly Weather â€” Sydney, Australia</h1>
      <div id="update">Loading...</div>
    </header>

    <div id="content">
      <div class="loader">Fetching data from the weather service...</div>
    </div>

    <footer>
      Data provided by Open-Meteo (no API key required). Coordinates: lat -33.8688, lon 151.2093 (Sydney).  
      You can open this file locally or host it on GitHub Pages.
    </footer>
  </div>

<script>
  const lat = -33.8688;
  const lon = 151.2093;
  const timezone = 'Australia/Sydney';

  const endpoint = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=${encodeURIComponent(timezone)}&forecast_days=7`;

  // Map weather codes to text + icons
  function weatherCodeToInfo(code){
    if(code === 0) return {text:'Clear sky', icon:'â˜€ï¸'};
    if(code === 1 || code === 2 || code === 3) return {text:'Partly cloudy', icon:'ðŸŒ¤ï¸'};
    if(code >= 45 && code <= 48) return {text:'Fog', icon:'ðŸŒ«ï¸'};
    if(code >= 51 && code <= 67) return {text:'Light/Moderate rain', icon:'ðŸŒ¦ï¸'};
    if(code >= 71 && code <= 77) return {text:'Snow / Hail', icon:'â„ï¸'};
    if(code >= 80 && code <= 82) return {text:'Rain showers', icon:'ðŸŒ§ï¸'};
    if(code >= 85 && code <= 86) return {text:'Snow showers', icon:'ðŸŒ¨ï¸'};
    if(code >= 95 && code <= 99) return {text:'Thunderstorm', icon:'â›ˆï¸'};
    return {text:'Variable conditions', icon:'ðŸŒ'};
  }

  async function fetchWeather(){
    try{
      const res = await fetch(endpoint);
      if(!res.ok) throw new Error('Error fetching data: '+res.status);
      const data = await res.json();

      const dates = data.daily.time;
      const tmax = data.daily.temperature_2m_max;
      const tmin = data.daily.temperature_2m_min;
      const codes = data.daily.weathercode;

      renderCards(dates, tmax, tmin, codes);

      const updatedAt = new Date().toLocaleString();
      document.getElementById('update').textContent = `Last update: ${updatedAt}`;
    }catch(err){
      document.getElementById('content').innerHTML = `<div class="loader">Failed to fetch data: ${err.message}</div>`;
      document.getElementById('update').textContent = 'Update error';
      console.error(err);
    }
  }

  function renderCards(dates, tmax, tmin, codes){
    const container = document.createElement('div');
    container.className = 'cards';

    for(let i=0;i<dates.length;i++){
      const card = document.createElement('div');
      card.className = 'card';

      const date = new Date(dates[i]);
      const weekday = date.toLocaleDateString('en-US', {weekday:'short', day:'numeric', month:'short'});

      const info = weatherCodeToInfo(codes[i]);

      card.innerHTML = `
        <div class="date">${weekday}</div>
        <div class="icon">${info.icon}</div>
        <div class="desc">${info.text}</div>
        <div class="temp">High ${Math.round(tmax[i])}Â°C Â· Low ${Math.round(tmin[i])}Â°C</div>
      `;

      container.appendChild(card);
    }

    const content = document.getElementById('content');
    content.innerHTML = '';
    content.appendChild(container);
  }

  fetchWeather();
  setInterval(fetchWeather, 30 * 60 * 1000); // update every 30 min
</script>
</body>
</html>
